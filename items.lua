return {
	PlaceObj('ModItemCode', {
		'name', "CONSTANTS_AI_source",
		'CodeFileName', "Code/CONSTANTS_AI_source.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "PATCH_AppendClass_source_classes",
		'CodeFileName', "Code/PATCH_AppendClass_source_classes.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "PATCH_UnitData",
		'CodeFileName', "Code/PATCH_UnitData.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "PATCH_call",
		'CodeFileName', "Code/PATCH_call.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "PATCH_ChangeUnitDataDef",
		'CodeFileName', "Code/PATCH_ChangeUnitDataDef.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "DEBUG",
		'CodeFileName', "Code/DEBUG.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_CustomFlanking",
		'CodeFileName', "Code/AIPOLICYPOS_CustomFlanking.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_CustomSeekCover",
		'CodeFileName', "Code/AIPOLICYPOS_CustomSeekCover.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_TryNotToBeFlanked",
		'CodeFileName', "Code/AIPOLICYPOS_TryNotToBeFlanked.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_MGSetupPosScore",
		'CodeFileName', "Code/AIPOLICYPOS_MGSetupPosScore.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_Attack_StanceAP",
		'CodeFileName', "Code/AIPOLICYPOS_Attack_StanceAP.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_MGSetupAP",
		'CodeFileName', "Code/AIPOLICYPOS_MGSetupAP.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_SaveAP",
		'CodeFileName', "Code/AIPOLICYPOS_SaveAP.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_DontBeExposedAtCloserRange",
		'comment', "--- moved to custom seek cover",
		'CodeFileName', "Code/AIPOLICYPOS_DontBeExposedAtCloserRange.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYPOS_GrenadeRange",
		'CodeFileName', "Code/AIPOLICYPOS_GrenadeRange.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYTARG_EnemyInCover",
		'CodeFileName', "Code/AIPOLICYTARG_EnemyInCover.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIPOLICYTARG_PindownTargeting",
		'CodeFileName', "Code/AIPOLICYTARG_PindownTargeting.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIACTION_ThrowFlare",
		'CodeFileName', "Code/AIACTION_ThrowFlare.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "AIACTION_PrepareWeapon",
		'CodeFileName', "Code/AIACTION_PrepareWeapon.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "UTIL",
		'CodeFileName', "Code/UTIL.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "CUAE_options",
		'CodeFileName', "Code/CUAE_options.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "REACTIONS_StopMGPackingUp",
		'CodeFileName', "Code/REACTIONS_StopMGPackingUp.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_ChangeEquipment",
		'CodeFileName', "Code/FUNCTION_ChangeEquipment.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_EndTurnAIAction",
		'CodeFileName', "Code/FUNCTION_EndTurnAIAction.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_ShouldMaxAim",
		'CodeFileName', "Code/FUNCTION_ShouldMaxAim.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_getAIShootingStanceBehaviorSelectionScore",
		'CodeFileName', "Code/FUNCTION_getAIShootingStanceBehaviorSelectionScore.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_getAISoldierFlankingBehaviorSelectionScore",
		'CodeFileName', "Code/FUNCTION_getAISoldierFlankingBehaviorSelectionScore.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_Get_HeavyGunnerShouldUsePositioningBehavior",
		'CodeFileName', "Code/FUNCTION_Get_HeavyGunnerShouldUsePositioningBehavior.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_get_ShouldUseGetCloserPositioningBehavior",
		'CodeFileName', "Code/FUNCTION_get_ShouldUseGetCloserPositioningBehavior.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_SignaturesCustomScoring",
		'CodeFileName', "Code/FUNCTION_SignaturesCustomScoring.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_CustomArchetypeFunc",
		'CodeFileName', "Code/FUNCTION_CustomArchetypeFunc.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_CanDegradeToSingleShot",
		'CodeFileName', "Code/FUNCTION_CanDegradeToSingleShot.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "FUNCTION_ScoreAttacksDetailed",
		'CodeFileName', "Code/FUNCTION_ScoreAttacksDetailed.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "PROPERTIES_Unit",
		'CodeFileName', "Code/PROPERTIES_Unit.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIPrecalcDamageScore",
		'CodeFileName', "Code/SOURCE_AIPrecalcDamageScore.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AICalcAttacksandAim",
		'CodeFileName', "Code/SOURCE_AICalcAttacksandAim.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AICreateContext",
		'comment', "--- logic for stance ap",
		'CodeFileName', "Code/SOURCE_AICreateContext.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIGetAttackArgs",
		'CodeFileName', "Code/SOURCE_AIGetAttackArgs.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AISelectAction",
		'CodeFileName', "Code/SOURCE_AISelectAction.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIEvalZones",
		'CodeFileName', "Code/SOURCE_AIEvalZones.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AITakeCover",
		'CodeFileName', "Code/SOURCE_AITakeCover.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIPolicyIndoorsOutdoors_EvalDest",
		'CodeFileName', "Code/SOURCE_AIPolicyIndoorsOutdoors_EvalDest.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIActionThrowGrenade_PrecalcAction",
		'CodeFileName', "Code/SOURCE_AIActionThrowGrenade_PrecalcAction.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIActionPinDown_PrecalcAction",
		'CodeFileName', "Code/SOURCE_AIActionPinDown_PrecalcAction.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIScoreDest",
		'CodeFileName', "Code/SOURCE_AIScoreDest.lua",
	}),
	PlaceObj('ModItemCode', {
		'name', "SOURCE_AIGetAttackTargetingOptions",
		'CodeFileName', "Code/SOURCE_AIGetAttackTargetingOptions.lua",
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "ImproveExplosiveStat",
		'DisplayName', "Improve Explosives Stat",
		'Help', "This option will moderately improve the enemies Explosive stat. Specialists (like Grenadier) will have a bigger boost. Some enemies will also have a small Dexterity boost. Some units may receive a small Dexterity boost as well. Highly recommended if using Rato's Explosive Overhaul 2. Restart after applying.",
		'DefaultValue', true,
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "AddHWStoGunners",
		'DisplayName', "Add HWS to Gunners",
		'Help', "Add Heavy Weapons Specialist perk to enemy Machine Gunners. Requires restart.",
		'DefaultValue', true,
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "AddFlares",
		'DisplayName', "Add Flares",
		'Help', "Add Flares to enemies at night",
		'DefaultValue', true,
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "CUAELoreProgression",
		'DisplayName', "CUAE Lore Friendly Weapons",
		'Help', "When using CUAE, enable a (subjective) lore friendly weapon progression based on unit affiliation.",
		'DefaultValue', true,
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "BoostStats",
		'DisplayName', "General Stat Boost",
		'Help', "If enabled, enemy unit stats will be improved based on their roles. For extra challenge.",
		'DefaultValue', true,
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "DontChangeEquip",
		'DisplayName', "Disable grenade loot re-distribution",
		'Help', "Disable grenade loot re-distribution, which can cause desync in coop playthroughs.",
	}),
	PlaceObj('ModItemOptionToggle', {
		'name', "UseSimpleAttacksScoring",
		'DisplayName', "Use Simple Attacks Scoring",
		'Help', "If you enable this function, the AI will use a simpler function to calculate its probable damage in a position against its targets. Enable it if facing major performance issues.",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'BiasId', "Standard",
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
					PlaceObj('AIPolicyCustomFlanking', {
						'ReserveAttackAP', "Stance",
						'visibility_mode', "team",
						'OnlyTarget', true,
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 150,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
			PlaceObj('PositioningAI', {
				'BiasId', "SoldierFlanking",
				'Weight', 10,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SoldierFlanking",
						'Value', -20,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'Comment', "Soldier Flanking",
				'Fallback', false,
				'RequiredKeywords', {
					"Soldier",
				},
				'Score', function (self, unit, proto_context, debug_data)
					unit.ai_context = unit.ai_context or AICreateContext(unit, proto_context)
					local dest, score = AIScoreReachableVoxels(unit.ai_context, self.EndTurnPolicies, 0)
					-----
					local custom_score = getAISoldierFlankingBehaviorSelectionScore(unit, proto_context)
					score = MulDivRound(score, custom_score, 100)
					-----
					return MulDivRound(score, self.Weight, 100)
				end,
				'OptLocWeight', 20,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 200,
					}),
					PlaceObj('AIPolicyCustomFlanking', {
						'Weight', 200,
						'Required', true,
						'ReserveAttackAP', "Stance",
						'visibility_mode', "team",
					}),
					PlaceObj('AIPolicyTryNotToBeFlanked', {
						'Required', true,
					}),
					PlaceObj('AIPolicyWeaponRange', {
						'RangeMin', 30,
						'RangeMax', 50,
					}),
					PlaceObj('AIPolicyCustomSeekCover', {
						'Weight', 500,
						'Required', true,
					}),
				},
				'TakeCoverChance', 100,
				'VoiceResponse', "AIFlanking",
			}),
		},
		Comment = "Keywords: Soldier, Sniper, Control, Ordnance, Smoke, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyCustomSeekCover', {
				'Weight', 200,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 300,
				'RangeMin', 30,
				'RangeMax', 50,
			}),
			PlaceObj('AIPolicyTryNotToBeFlanked', nil),
		},
		OptLocSearchRadius = 80,
		PrefStance = "Crouch",
		SignatureActions = {
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Autofire",
				'Weight', 180,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return AutoFire_CustomScoring(self, context)
				end,
				'action_id', "AutoFire",
				'Aiming', "Maximum",
				'AttackTargeting', set( "Torso" ),
			}),
			PlaceObj('AIConeAttack', {
				'BiasId', "Overwatch",
				'Weight', 180,
				'CustomScoring', function (self, context)
					return Overwatch_CustomScoring(self, context)
				end,
				'team_score', 0,
				'min_score', 100,
				'enemy_cover_mod', 80,
				'action_id', "Overwatch",
			}),
			PlaceObj('AIActionMobileShot', {
				'Weight', 160,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIActionMobileShot', {
				'Weight', 160,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "GroinShot",
				'Weight', 130,
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Groin" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "ArmShot",
				'Weight', 130,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "ArmShot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Arms" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "LegShot",
				'Weight', 130,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "LegShot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Legs" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AssaultGrenadeThrow",
				'Weight', 90,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "AssaultGrenadeThrow",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'self_score_mod', -1000,
				'min_score', 100,
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AssaultGrenadeThrow200",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "AssaultGrenadeThrow200",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'self_score_mod', -1000,
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "SmokeGrenade",
				'Weight', 160,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Value', -50,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', -50,
				'team_score', 100,
				'self_score_mod', 100,
				'min_score', 100,
				'MinDist', 0,
				'AllowedAoeTypes', set( "smoke" ),
			}),
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'CustomScoring', function (self, context)
					 return self.Weight, false, self.Priority
				end,
				'enemy_score', 110,
				'team_score', -1,
				'self_score_mod', -1,
				'min_score', 100,
				'MinDist', 5000,
			}),
			PlaceObj('AIActionHeavyWeaponAttack', {
				'BiasId', "LauncherFire",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "LauncherFire",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "LauncherFire",
						'Value', -20,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'self_score_mod', -1000,
				'min_score', 100,
				'enemy_cover_mod', 50,
				'MinDist', 7000,
				'LimitRange', true,
				'MaxTargetRange', 35,
			}),
			PlaceObj('AIActionCharge', {
				'DestPreference', "nearest",
			}),
		},
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingCancelShot', nil),
		},
		group = "Default",
		id = "Soldier",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		BaseAttackWeight = 150,
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'BiasId', "Standard",
				'OptLocWeight', 20,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
					PlaceObj('AIPolicySaveAP', {
						'Weight', 200,
						'Required', true,
						'ReserveAP', 0,
						'SaveforBoltingAction', true,
						'SaveforShootingStance', true,
					}),
					PlaceObj('AIPolicyCustomFlanking', {
						'Weight', 200,
						'ReserveAttackAP', "Stance",
						'visibility_mode', "team",
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 200,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'OptLocWeight', 0,
				'TakeCoverChance', 0,
			}),
		},
		Comment = "Keywords: Soldier, Sniper, Control, Ordnance, Smoke, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyHighGround', {
				'Weight', 150,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 300,
				'RangeMin', 30,
				'RangeMax', 50,
			}),
			PlaceObj('AIPolicyTryNotToBeFlanked', {
				'Weight', 50,
			}),
			PlaceObj('AIPolicyCustomSeekCover', {
				'Weight', 150,
				'ExposedAtCloseRange_Score', -20,
			}),
		},
		OptLocSearchRadius = 80,
		PrefStance = "Crouch",
		SignatureActions = {
			PlaceObj('AIActionPinDown', {
				'BiasId', "PinDownAttack",
				'CustomScoring', function (self, context)
					return Pindown_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIActionPinDown', {
				'BiasId', "PinDownAttack",
				'CustomScoring', function (self, context)
					return Pindown_CustomScoring(self, context)
				end,
				'AttackTargeting', "Head",
			}),
			PlaceObj('AIConeAttack', {
				'BiasId', "Overwatch",
				'CustomScoring', function (self, context)
					return Overwatch_CustomScoring(self, context)
				end,
				'team_score', 0,
				'min_score', 100,
				'enemy_cover_mod', 80,
				'action_id', "Overwatch",
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "GroinShot",
				'Weight', 200,
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Groin" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Headshot",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "Headshot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Head" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "ArmShot",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "ArmShot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Arms" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "LegShot",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "LegShot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Legs" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AssaultGrenadeThrow",
				'Weight', 50,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "AssaultGrenadeThrow",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'self_score_mod', -1000,
				'min_score', 100,
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "SmokeGrenade",
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Value', -50,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', -50,
				'team_score', 100,
				'self_score_mod', 100,
				'MinDist', 0,
				'AllowedAoeTypes', set( "smoke" ),
			}),
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'CustomScoring', function (self, context)
					 return self.Weight, false, self.Priority
				end,
				'enemy_score', 110,
				'team_score', -1,
				'self_score_mod', -1,
				'min_score', 100,
				'MinDist', 5000,
			}),
		},
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingPindownTargeting', {
				'Score', 15,
			}),
			PlaceObj('AITargetingCancelShot', nil),
		},
		group = "Default",
		id = "RATOAI_Sniper",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		Behaviors = {
			PlaceObj('StandardAI', {
				'Score', function (self, unit, proto_context, debug_data)
					return self.Weight
					--return getStandardBehaviorScore_HeavyGunner(self, unit, proto_context, debug_data)
				end,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
					PlaceObj('AIPolicyWeaponRange', {
						'Weight', 300,
						'RangeMin', 30,
						'RangeMax', 50,
					}),
					PlaceObj('AIPolicyMGSetupAP', {
						'Weight', 150,
					}),
				},
				'SignatureActions', {
					PlaceObj('AIActionMGSetup', {
						'BiasId', "MGSetup",
						'Weight', 300,
						'Priority', true,
						'CustomScoring', function (self, context)
							local unit = context.unit
							if unit:HasStatusEffect("ManningEmplacement") or unit:HasStatusEffect("StationedMachineGun") then
								return 0, true, false   
							end
							
							return self.Weight, false, self.Priority
						end,
						'team_score', -10,
						'min_score', 100,
						'enemy_cover_mod', 30,
						'cur_zone_mod', 140,
					}),
					PlaceObj('AIActionMGBurstFire', {
						'Weight', 200,
						'CustomScoring', function (self, context)
							return AutoFire_CustomScoring(self, context)
						end,
						'Aiming', "Remaining AP",
						'AttackTargeting', set( "Torso" ),
					}),
				},
				'TargetingPolicies', {
					PlaceObj('AITargetingEnemyInCover', nil),
				},
				'TakeCoverChance', 0,
				'override_attack_id', "BurstFire",
				'override_cost_id', "MGSetup",
			}),
			PlaceObj('PositioningAI', {
				'Comment', "MG Setup",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					if not Get_HeavyGunnerShouldUsePositioningBehavior(self, unit, proto_context, debug_data) then
						return 0
					end
					
					unit.ai_context = unit.ai_context or AICreateContext(unit, proto_context)
					local dest, score = AIScoreReachableVoxels(unit.ai_context, self.EndTurnPolicies, 0)
					return MulDivRound(score, self.Weight, 100)
				end,
				'OptLocWeight', 20,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyMGSetupPosScore', {
						'Weight', 800,
					}),
					PlaceObj('AIPolicyTryNotToBeFlanked', {
						'Weight', 50,
						'Required', true,
					}),
					PlaceObj('AIPolicyLastEnemyPos', {
						'Weight', 500,
					}),
					PlaceObj('AIPolicyWeaponRange', {
						'Weight', 300,
						'RangeMin', 30,
						'RangeMax', 40,
					}),
					PlaceObj('AIPolicyWeaponRange', {
						'Weight', 50,
						'RangeMin', 41,
						'RangeMax', 60,
					}),
					PlaceObj('AIPolicyLosToEnemy', {
						'Required', true,
					}),
					PlaceObj('AIPolicyIndoorsOutdoors', {
						'Indoors', false,
					}),
					PlaceObj('AIPolicyMGSetupAP', {
						'Required', true,
					}),
				},
				'SignatureActions', {
					PlaceObj('AIActionMGSetup', {
						'BiasId', "MGSetup",
						'Weight', 500,
						'Priority', true,
						'CustomScoring', function (self, context)
							local unit = context.unit
							if unit:HasStatusEffect("ManningEmplacement") or unit:HasStatusEffect("StationedMachineGun") then
								return 0, true, false   
							end
							
							return self.Weight, false, self.Priority
						end,
						'team_score', -10,
						'min_score', 100,
						'enemy_cover_mod', 50,
						'cur_zone_mod', 140,
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 200,
				'Comment', "In Setup",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					if unit:HasStatusEffect("ManningEmplacement") or unit:HasStatusEffect("StationedMachineGun") then
						local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
						return MulDivRound(score, self.Weight, 100)
					end
					
					return 0
				end,
				'SignatureActions', {
					PlaceObj('AIActionMGBurstFire', {
						'Weight', 200,
						'Aiming', "Maximum",
						'AttackTargeting', set( "Torso" ),
					}),
					PlaceObj('AIActionMGSetup', {
						'team_score', -10,
						'enemy_cover_mod', 50,
						'cur_zone_mod', 140,
					}),
				},
				'TargetingPolicies', {
					PlaceObj('AITargetingEnemyInCover', nil),
				},
				'TakeCoverChance', 0,
			}),
		},
		OptLocPolicies = {
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 500,
				'RangeMin', 30,
				'RangeMax', 50,
			}),
			PlaceObj('AIPolicyLosToEnemy', {
				'Weight', 200,
			}),
			PlaceObj('AIPolicyIndoorsOutdoors', {
				'Indoors', false,
			}),
		},
		OptLocSearchRadius = 100,
		PrefStance = "Prone",
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingEnemyHealth', {
				'Health', 50,
				'AboveHealth', true,
			}),
			PlaceObj('AITargetingEnemyInCover', nil),
		},
		group = "Simplified",
		id = "HeavyGunner",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		Behaviors = {
			PlaceObj('StandardAI', {
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 150,
					}),
					PlaceObj('AIPolicyCustomFlanking', {
						'Weight', 150,
						'ReserveAttackAP', "Stance",
						'visibility_mode', "team",
						'OnlyTarget', true,
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('PositioningAI', {
				'BiasId', "Flanking",
				'Weight', 40,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "ExplosiveGrenadeThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "AOEGrenadeThrow",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'Comment', "Flanking",
				'Fallback', false,
				'OptLocWeight', 20,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyFlanking', {
						'Weight', 150,
						'AllyPlannedPosition', true,
					}),
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 150,
					}),
					PlaceObj('AIPolicyCustomFlanking', {
						'Weight', 200,
						'Required', true,
						'ReserveAttackAP', "AP",
						'visibility_mode', "team",
						'ScalePerDistance', true,
					}),
					PlaceObj('AIPolicyTryNotToBeFlanked', nil),
					PlaceObj('AIPolicyCustomSeekCover', {
						'Required', true,
						'ExposedAtCloseRange_Score', -15,
					}),
				},
				'TakeCoverChance', 100,
				'VoiceResponse', "AIFlanking",
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 50,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
		},
		Comment = "Keywords: Flank, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 300,
				'RangeBase', "Absolute",
				'RangeMin', 5,
				'RangeMax', 12,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyTryNotToBeFlanked', nil),
			PlaceObj('AIPolicyCustomSeekCover', {
				'Weight', 180,
				'ExposedAtCloseRange_Score', -20,
			}),
		},
		OptLocSearchRadius = 80,
		PrefStance = "Crouch",
		SignatureActions = {
			PlaceObj('AIActionMobileShot', {
				'BiasId', "RunAndGun",
				'Weight', 200,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIActionMobileShot', {
				'BiasId', "MobileShot",
				'Weight', 200,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Autofire",
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return AutoFire_CustomScoring(self, context)
				end,
				'action_id', "AutoFire",
				'Aiming', "Maximum",
				'AttackTargeting', set( "Torso" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "ExplosiveGrenadeThrow",
				'min_score', 130,
				'enemy_cover_mod', 50,
				'MinDist', 6000,
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AOEGrenadeThrow",
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "SmokeGrenade",
				'Weight', 80,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Value', -50,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', -50,
				'team_score', 100,
				'self_score_mod', 100,
				'MinDist', 0,
				'AllowedAoeTypes', set( "smoke" ),
			}),
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'team_score', 0,
				'self_score_mod', 0,
				'min_score', 100,
				'TargetLastAttackPos', true,
			}),
			PlaceObj('AIConeAttack', {
				'CustomScoring', function (self, context)
					return Overwatch_CustomScoring(self, context)
				end,
				'team_score', -10,
				'enemy_cover_mod', 80,
				'action_id', "Overwatch",
			}),
		},
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingEnemyHealth', {
				'Health', 50,
			}),
			PlaceObj('AITargetingEnemyWeapon', {
				'EnemyWeapon', "Sniper",
			}),
		},
		group = "Simplified",
		id = "Skirmisher",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		Behaviors = {
			PlaceObj('StandardAI', {
				'turn_phase', "Early",
				'OptLocWeight', 200,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 10,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
			PlaceObj('PositioningAI', {
				'BiasId', "GrenadierPositioning",
				'Weight', 10,
				'Comment', "Grenadier Positioning",
				'Fallback', false,
				'turn_phase', "Early",
				'OptLocWeight', 30,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyGrenadeRange', {
						'Weight', 200,
						'Required', true,
						'RangeMin', 40,
						'RangeMax', 60,
						'AllowedTriggerTypes', set( "Contact", "Timed" ),
						'SaveAP', true,
					}),
					PlaceObj('AIPolicyCustomFlanking', {
						'Weight', 50,
						'OnlyTarget', true,
					}),
				},
				'TakeCoverChance', 100,
			}),
		},
		Comment = "Keywords: Flank, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyIndoorsOutdoors', {
				'Weight', 200,
				'Indoors', false,
			}),
			PlaceObj('AIPolicyGrenadeRange', {
				'Weight', 300,
				'RangeMin', 30,
				'RangeMax', 50,
				'AllowedTriggerTypes', set( "Contact", "Timed" ),
			}),
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 80,
				'RangeMin', 30,
				'RangeMax', 50,
			}),
			PlaceObj('AIPolicyCustomSeekCover', {
				'Weight', 150,
				'ExposedAtCloseRange_Score', -20,
			}),
		},
		OptLocSearchRadius = 100,
		SignatureActions = {
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "ExplosiveGrenadeThrow",
				'Weight', 500,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "ExplosiveGrenadeThrow",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'min_score', 100,
				'enemy_cover_mod', 50,
				'MinDist', 4000,
				'TargetLastAttackPos', true,
				'AllowedTriggerTypes', set( "Contact" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "ExplosiveGrenadeThrowTimed",
				'Weight', 400,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "ExplosiveGrenadeThrowTimed",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'min_score', 100,
				'enemy_cover_mod', 50,
				'MinDist', 4000,
				'AllowedTriggerTypes', set( "Proximity", "Proximity-Timed", "Timed" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AOEGrenadeThrow",
				'MinDist', 4000,
				'AllowedAoeTypes', set( "fire", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "SmokeGrenade",
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Value', -50,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', -50,
				'team_score', 100,
				'self_score_mod', 100,
				'MinDist', 0,
				'AllowedAoeTypes', set( "smoke" ),
			}),
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'Weight', 300,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', 110,
				'team_score', -1,
				'self_score_mod', -1,
				'min_score', 100,
			}),
		},
		TargetScoreRandomization = 10,
		group = "RatoAI",
		id = "RATOAI_Demolition",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		Behaviors = {
			PlaceObj('StandardAI', {
				'Weight', 75,
				'turn_phase', "Early",
				'OptLocWeight', 200,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 10,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
			PlaceObj('PositioningAI', {
				'BiasId', "RocketeerPositioning",
				'Weight', 50,
				'Comment', "Rocketeer Positioning",
				'Fallback', false,
				'turn_phase', "Early",
				'OptLocWeight', 30,
				'EndTurnPolicies', {
					PlaceObj('AIPolicySaveAP', {
						'Required', true,
						'ReserveAP', 6,
					}),
					PlaceObj('AIPolicyWeaponRange', {
						'Weight', 200,
						'RangeBase', "Absolute",
						'RangeMin', 10,
						'RangeMax', 16,
					}),
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 200,
					}),
				},
				'TakeCoverChance', 100,
			}),
		},
		Comment = "Keywords: Flank, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 500,
				'RangeBase', "Absolute",
				'RangeMin', 12,
				'RangeMax', 18,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyIndoorsOutdoors', {
				'Indoors', false,
			}),
		},
		OptLocSearchRadius = 100,
		SignatureActions = {
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'Weight', 300,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', 110,
				'team_score', -1,
				'self_score_mod', -1,
				'min_score', 100,
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Autofire",
				'Weight', 150,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return AutoFire_CustomScoring(self, context)
				end,
				'action_id', "AutoFire",
				'Aiming', "Maximum",
				'AttackTargeting', set( "Torso" ),
			}),
			PlaceObj('AIActionHeavyWeaponAttack', {
				'Weight', 600,
				'Priority', true,
				'min_score', 100,
				'enemy_cover_mod', 50,
				'MinDist', 6000,
				'action_id', "RocketLauncherFire",
				'LimitRange', true,
				'MaxTargetRange', 40,
			}),
		},
		TargetScoreRandomization = 10,
		group = "RatoAI",
		id = "RATOAI_Rocketeer",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Neck", "Torso" ),
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'turn_phase', "Late",
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
				},
				'TakeCoverChance', 0,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 10,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
		},
		Comment = "Keywords: Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 500,
				'RangeBase', "Melee",
				'RangeMin', 0,
				'RangeMax', 6,
			}),
			PlaceObj('AIPolicyWeaponRange', {
				'RangeBase', "Absolute",
				'RangeMin', 0,
				'RangeMax', 10,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyTryNotToBeFlanked', {
				'Weight', 50,
			}),
			PlaceObj('AIPolicyCustomSeekCover', {
				'ExposedAtCloseRange_Score', -8,
			}),
		},
		OptLocSearchRadius = 80,
		SignatureActions = {
			PlaceObj('AIActionMobileShot', {
				'BiasId', "RunAndGun",
				'Priority', true,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIActionMobileShot', {
				'BiasId', "MobileShot",
				'Priority', true,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "StunGrenade",
				'Weight', 50,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "StunGrenade",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'min_score', 100,
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "SmokeGrenade",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Value', -50,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', 0,
				'team_score', 100,
				'self_score_mod', 100,
				'MinDist', 0,
				'AllowedAoeTypes', set( "smoke" ),
			}),
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'team_score', -1,
				'self_score_mod', -1,
				'min_score', 100,
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "Nova",
				'Weight', 300,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "Nova",
						'Effect', "disable",
					}),
				},
				'RequiredKeywords', {
					"Nova",
				},
				'team_score', 0,
				'self_score_mod', 100,
				'MinDist', 0,
				'MaxDist', 3000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
		},
		TargetChangePolicy = "restart",
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingEnemyWeapon', nil),
			PlaceObj('AITargetingEnemyWeapon', {
				'Weight', 150,
				'EnemyWeapon', "MachineGun",
			}),
			PlaceObj('AITargetingEnemyWeapon', {
				'Weight', 150,
				'EnemyWeapon', "Sniper",
			}),
		},
		group = "Simplified",
		id = "Brute",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Arms", "Torso" ),
		BaseAttackWeight = 80,
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'BiasId', "Standard",
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 20,
					}),
					PlaceObj('AIPolicyWeaponRange', {
						'RangeMin', 30,
						'RangeMax', 50,
					}),
					PlaceObj('AIPolicyCustomSeekCover', {
						'Weight', 300,
					}),
				},
				'SignatureActions', {
					PlaceObj('AIActionMobileShot', {
						'Priority', true,
						'NotificationText', "",
						'CustomScoring', function (self, context)
							return MobileAttack_CustomScoring(self, context)
						end,
						'action_id', "RunAndGun",
					}),
					PlaceObj('AIActionMobileShot', {
						'Priority', true,
						'NotificationText', "",
						'CustomScoring', function (self, context)
							return MobileAttack_CustomScoring(self, context)
						end,
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('StandardAI', {
				'BiasId', "Healer",
				'Priority', true,
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					for _, ally in ipairs(unit.team.units) do
						if not ally:IsDead() and ally.HitPoints < MulDivRound(ally.MaxHitPoints, 70, 100) then
							return self.Weight
						end
					end
					return 0
				end,
				'turn_phase', "Late",
				'OptLocWeight', 1,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyHealingRange', {
						'Weight', 300,
						'BleedingWeight', 80,
						'CanUseMod', 1000,
					}),
				},
				'SignatureActions', {
					PlaceObj('AIActionBandage', {
						'Priority', true,
						'RequiredKeywords', {
							"Heal",
						},
						'BleedingWeight', 80,
						'CanUseMod', 1000,
					}),
					PlaceObj('AIActionStim', {
						'Priority', true,
						'RequiredKeywords', {
							"Stim",
						},
						'TargetRules', {
							PlaceObj('AIStimRule', {
								'Keyword', "Flank",
								'Weight', 100,
							}),
							PlaceObj('AIStimRule', {
								'Keyword', "Control",
								'Weight', 50,
							}),
							PlaceObj('AIStimRule', {
								'Keyword', "Explosives",
								'Weight', 50,
							}),
							PlaceObj('AIStimRule', {
								'Keyword', "Ordnance",
								'Weight', 50,
							}),
							PlaceObj('AIStimRule', {
								'Keyword', "RunAndGun",
								'Weight', 100,
							}),
						},
					}),
				},
				'TakeCoverChance', 0,
			}),
		},
		OptLocPolicies = {
			PlaceObj('AIPolicyCustomSeekCover', nil),
			PlaceObj('AIPolicyLosToEnemy', nil),
		},
		OptLocSearchRadius = 80,
		PrefStance = "Crouch",
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingCancelShot', {
				'Weight', 200,
			}),
		},
		group = "Simplified",
		id = "Medic",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'TakeCoverChance', 0,
			}),
		},
		Comment = "used to advance toward last known enemy location",
		FallbackAction = "overwatch",
		OptLocPolicies = {
			PlaceObj('AIPolicyLastEnemyPos', nil),
			PlaceObj('AIPolicyCustomSeekCover', {
				'ExposedAtCloseRange_Score', -10,
			}),
		},
		OptLocSearchRadius = 80,
		group = "System",
		id = "Scout_LastLocation",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		Behaviors = {
			PlaceObj('StandardAI', {
				'Weight', 50,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
				},
				'TakeCoverChance', 0,
			}),
			PlaceObj('PositioningAI', {
				'BiasId', "RetreatingMarksman",
				'Comment', "Retreat",
				'Fallback', false,
				'OptLocWeight', 20,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
					PlaceObj('AIPolicyWeaponRange', {
						'Weight', 500,
						'Required', true,
						'RangeBase', "Absolute",
						'RangeMin', 10,
						'RangeMax', 10,
					}),
					PlaceObj('AIPolicyTryNotToBeFlanked', nil),
					PlaceObj('AIPolicyCustomSeekCover', {
						'Weight', 150,
						'Required', true,
						'ExposedAtCloseRange_Score', -15,
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 10,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
		},
		Comment = "Keywords: Flank, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 200,
				'RangeBase', "Absolute",
				'RangeMin', 10,
				'RangeMax', 14,
			}),
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 20,
				'RangeBase', "Absolute",
				'RangeMin', 16,
				'RangeMax', 20,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyTryNotToBeFlanked', nil),
			PlaceObj('AIPolicyCustomSeekCover', {
				'Weight', 150,
			}),
		},
		OptLocSearchRadius = 80,
		PrefStance = "Crouch",
		SignatureActions = {
			PlaceObj('AIActionMobileShot', {
				'BiasId', "RunAndGun",
				'Weight', 500,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIActionMobileShot', {
				'BiasId', "MobileShot",
				'Weight', 500,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Autofire",
				'Weight', 50,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return AutoFire_CustomScoring(self, context)
				end,
				'action_id', "AutoFire",
				'Aiming', "Maximum",
				'AttackTargeting', set( "Torso" ),
			}),
		},
		TargetScoreRandomization = 10,
		group = "RatoAI",
		id = "RATOAI_RetreatingMarksman",
	}),
	PlaceObj('ModItemAIArchetype', {
		Behaviors = {
			PlaceObj('StandardAI', {
				'Priority', true,
				'Comment', "breaking pindown",
				'Score', function (self, unit, proto_context, debug_data)
					local enemies = {}
					for _, descr in pairs(g_Pindown) do
						if descr.target == self then
							enemies[#enemies + 1] = enemy
						end
					end
					return #enemies > 0 and self.Weight or 0
				end,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyLosToEnemy', {
						'Invert', true,
					}),
					PlaceObj('AIPolicyDealDamage', nil),
				},
				'TakeCoverChance', 0,
			}),
			PlaceObj('StandardAI', {
				'Comment', "fallback (aggressive)",
				'Fallback', false,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 600,
					}),
					PlaceObj('AIPolicyWeaponRange', {
						'RangeBase', "Absolute",
						'RangeMin', 0,
						'RangeMax', 5,
					}),
				},
				'TakeCoverChance', 0,
			}),
		},
		OptLocPolicies = {
			PlaceObj('AIPolicyLosToEnemy', nil),
		},
		OptLocSearchRadius = 80,
		SignatureActions = {
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
		},
		group = "System",
		id = "PinnedDown",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseAttackTargeting = set( "Torso" ),
		BaseAttackWeight = 150,
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'BiasId', "Standard",
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
					PlaceObj('AIPolicyCustomFlanking', {
						'RequiredKeywords', {
							"Soldier",
						},
						'Weight', 200,
						'ReserveAttackAP', "Stance",
						'OnlyTarget', true,
					}),
					PlaceObj('AIPolicyTryNotToBeFlanked', nil),
					PlaceObj('AIPolicyWeaponRange', {
						'Weight', 150,
						'RangeBase', "Absolute",
						'RangeMin', 6,
						'RangeMax', 10,
					}),
					PlaceObj('AIPolicyCustomSeekCover', {
						'Weight', 200,
						'ExposedAtCloseRange_Score', -10,
					}),
				},
				'TakeCoverChance', 50,
			}),
			PlaceObj('HoldPositionAI', {
				'Weight', 50,
				'Comment', "ShootingStance",
				'Fallback', false,
				'Score', function (self, unit, proto_context, debug_data)
					local score = getAIShootingStanceBehaviorSelectionScore(unit, proto_context)
					return MulDivRound(score, self.Weight, 100)
				end,
				'TakeCoverChance', 0,
			}),
		},
		Comment = "Keywords: Soldier, Sniper, Control, Ordnance, Smoke, Explosives",
		OptLocPolicies = {
			PlaceObj('AIPolicyCustomSeekCover', {
				'ExposedAtCloseRange_Score', -10,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
			PlaceObj('AIPolicyTryNotToBeFlanked', nil),
			PlaceObj('AIPolicyWeaponRange', {
				'RangeBase', "Melee",
			}),
		},
		OptLocSearchRadius = 80,
		SignatureActions = {
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Autofire",
				'Weight', 150,
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return AutoFire_CustomScoring(self, context)
				end,
				'action_id', "AutoFire",
				'Aiming', "Maximum",
				'AttackTargeting', set( "Torso" ),
			}),
			PlaceObj('AIConeAttack', {
				'BiasId', "Overwatch",
				'Weight', 120,
				'CustomScoring', function (self, context)
					return Overwatch_CustomScoring(self, context)
				end,
				'team_score', 0,
				'min_score', 140,
				'enemy_cover_mod', 80,
				'action_id', "Overwatch",
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
				'action_id', "RunAndGun",
			}),
			PlaceObj('AIActionMobileShot', {
				'NotificationText', "",
				'CustomScoring', function (self, context)
					return MobileAttack_CustomScoring(self, context)
				end,
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "GroinShot",
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Groin" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "ArmShot",
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "ArmShot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Arms" ),
			}),
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "LegShot",
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "LegShot",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'CustomScoring', function (self, context)
					return SingleShotTargeted_CustomScoring(self, context)
				end,
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Legs" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AssaultGrenadeThrow",
				'Weight', 80,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "AssaultGrenadeThrow",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'self_score_mod', -1000,
				'min_score', 100,
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "AssaultGrenadeThrow200",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "AssaultGrenadeThrow200",
						'Effect', "disable",
						'Period', 0,
					}),
				},
				'self_score_mod', -1000,
				'MinDist', 6000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "SmokeGrenade",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Effect', "disable",
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "SmokeGrenade",
						'Value', -50,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'enemy_score', -50,
				'team_score', 100,
				'self_score_mod', 100,
				'MinDist', 0,
				'AllowedAoeTypes', set( "smoke" ),
			}),
			PlaceObj('AIActionThrowFlare', {
				'BiasId', "FlareThrow",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "FlareThrow",
						'Value', -30,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'CustomScoring', function (self, context)
					 return self.Weight, false, self.Priority
				end,
				'enemy_score', 110,
				'team_score', -1,
				'self_score_mod', -1,
				'min_score', 100,
				'MinDist', 5000,
			}),
			PlaceObj('AIActionHeavyWeaponAttack', {
				'BiasId', "LauncherFire",
				'Weight', 200,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "LauncherFire",
						'Effect', "disable",
						'Period', 0,
					}),
					PlaceObj('AIBiasModification', {
						'BiasId', "LauncherFire",
						'Value', -20,
						'Period', 0,
						'ApplyTo', "Team",
					}),
				},
				'self_score_mod', -1000,
				'min_score', 100,
				'enemy_cover_mod', 50,
				'MinDist', 7000,
				'LimitRange', true,
				'MaxTargetRange', 35,
			}),
			PlaceObj('AIActionCharge', {
				'Weight', 800,
				'DestPreference', "nearest",
			}),
		},
		TargetScoreRandomization = 10,
		TargetingPolicies = {
			PlaceObj('AITargetingCancelShot', nil),
		},
		group = "Default",
		id = "Pierre",
	}),
	PlaceObj('ModItemAIArchetype', {
		BaseMovementWeight = 10,
		Behaviors = {
			PlaceObj('StandardAI', {
				'BiasId', "Standard",
				'Weight', 80,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyTakeCover', {
						'Weight', 50,
						'visibility_mode', "team",
					}),
					PlaceObj('AIPolicyDealDamage', {
						'Weight', 400,
					}),
				},
			}),
			PlaceObj('StandardAI', {
				'Fallback', false,
				'EndTurnPolicies', {
					PlaceObj('AIPolicyDealDamage', nil),
				},
				'SignatureActions', {
					PlaceObj('AIAttackSingleTarget', {
						'BiasId', "Autofire",
						'Weight', 70,
						'Priority', true,
						'NotificationText', "",
						'action_id', "AutoFire",
						'Aiming', "Maximum",
						'AttackTargeting', set( "Torso" ),
					}),
				},
			}),
		},
		Comment = "basic flank and attack AI",
		OptLocPolicies = {
			PlaceObj('AIPolicyWeaponRange', {
				'Weight', 600,
				'RangeBase', "Absolute",
				'RangeMin', 4,
				'RangeMax', 8,
			}),
			PlaceObj('AIPolicyHighGround', {
				'Weight', 30,
			}),
			PlaceObj('AIPolicyLosToEnemy', nil),
		},
		OptLocSearchRadius = 80,
		PrefStance = "Crouch",
		SignatureActions = {
			PlaceObj('AIAttackSingleTarget', {
				'BiasId', "Autofire",
				'Weight', 70,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "Autofire",
						'Value', -500,
						'Period', 2,
					}),
				},
				'NotificationText', "",
				'action_id', "AutoFire",
				'Aiming', "Remaining AP",
				'AttackTargeting', set( "Torso" ),
			}),
			PlaceObj('AIActionThrowGrenade', {
				'BiasId', "WildThrowGrenade",
				'Weight', 300,
				'Priority', true,
				'OnActivationBiases', {
					PlaceObj('AIBiasModification', {
						'BiasId', "WildThrowGrenade",
						'Effect', "disable",
						'Value', -300,
						'Period', 0,
					}),
				},
				'team_score', 0,
				'self_score_mod', -1000,
				'AllowedAoeTypes', set( "fire", "none", "teargas", "toxicgas" ),
			}),
		},
		TargetingPolicies = {
			PlaceObj('AITargetingCancelShot', {
				'Weight', 80,
			}),
		},
		comment = "not changed",
		group = "Lieutenants",
		id = "TheMajor",
	}),
}